<!DOCTYPE html>
<!-- saved from url=(0056) -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>abendrot | index</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="description" content="SAP HANA Cloud Tutorial">
    <meta name="keywords"    content="SAP, HANA, Cloud, Tutorial">
    <meta name="author" content="Christophe ThiÃ©baud">

    <!-- Le styles -->

    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="assets/css/docs.css" rel="stylesheet">
    <link href="assets/css/prettify.css" rel="stylesheet">

    <link href="style.css" rel="stylesheet">

    <link rel="shortcut icon" href="favicon.ico">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

  </head>

  <body data-spy="scroll" data-target=".bs-docs-sidebar" data-twttr-rendered="true">

    <a href="https://github.com/cthiebaud/abendrot"><img style="position: absolute; top: 0; right: 0; border: 0; z-index:1234;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork abendrot on GitHub"></a>

    <!-- Navbar
    ================================================== -->
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href=".">a&nbsp;b&nbsp;e&nbsp;n&nbsp;d&nbsp;r&nbsp;o&nbsp;t</a>

          <div class="nav-collapse collapse">
            <ul class="nav">
              <li>
                <a href=".">getting started</a>
              </li>
              <li class="active">
                <a href="./identity.html">identity</a>
              </li>
              <li>
                <a href="./rest.html">rest</a>
              </li>
              <li>
                <a href="./persist.html">persist</a>
              </li>
              <li>
                <a href="http://hana.abendrot.org">demo app</a>
              </li>
            </ul>
          </div>
          
        </div>
      </div>
    </div>

  <!-- Subhead
  ================================================== -->
  <header class="jumbotron subhead" id="overview">
    <div class="container">
      <h1 class="brand">abendrot</h1>
    </div>
  </header>

  <div class="container">

    <!-- Docs nav
    ================================================== -->
    <div class="row">
      <div class="span3 bs-docs-sidebar">
        <ul class="nav nav-list bs-docs-sidenav affix-top">
          <li class="active"><a href="#look-in-the-motor">     <i class="icon-chevron-right"></i> Look Inside the Motor</a></li>
          <li class=""><a href="#add-security-constraint">     <i class="icon-chevron-right"></i> Add Security Constraint</a></li>
          <li class=""><a href="#get-back-tomcat-in-the-game"> <i class="icon-chevron-right"></i> Get Back Tomcat in the Game</a></li>
          <li class=""><a href="#who-am-i">                   <i class="icon-chevron-right"></i> Who am I ?</a></li>
          <li class=""><a href="#conclusion">                  <i class="icon-chevron-right"></i> Conclusion</a></li>
          <!-- li class=""><a href="#coming-soon"><i class="icon-chevron-right"></i> Coming soon ...</a></li -->
        </ul>
      </div>
      <div class="span9">

        <!-- Look Inside the Motor
        ================================================== -->
        <section id="look-in-the-motor">
          <div class="page-header">
            <h1>1. Look Inside the Motor</h1>
          </div>
          <div class="row-fluid">
            <ul class="thumbnails">
              <li class="span1">
                <span class="thumbnail">
                    <img src="icons/lego_car.jpg" alt="">
                </a>
              </li>
              <div class="lead">Now that the <strong>abendrot</strong> application is deployed on the cloud (cf. <a href="./index.html">part 1</a>), it is good to have a sneak inside the motor.
                Let's write an elementary java server page to display java system properties.
              </div>
            </ul>              
            <div class="accordion" id="accordion-look-in-the-motor">
              <div class="accordion-group">
                <div class="accordion-heading">
                  <p>Create a new <code>spy.jsp</code> file in the <code>src/main/webapp</code> directory. Copy &amp; paste the code from <a href="https://github.com/cthiebaud/abendrot/blob/b9dd4662317c49d2da05981340e252d7d4324e14/src/main/webapp/spy.jsp">this version from github</a>. Run in your local Tomcat server. Results:
                  <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-look-in-the-motor" href="#collapse-look-in-the-motor-1"><i class="icon-chevron-right"></i></a>
                  </p>
                </div>
                <div id="collapse-look-in-the-motor-1" class="accordion-body collapse out">
                  <div class="accordion-inner">
                    <!-- img src="./images/bare_spy_in_local_tomcat.png" alt="" alt=""--><span class="img_later" data-src="./images/bare_spy_in_local_tomcat.png" alt=""></span>
                  </div>
                </div>
              </div>
              <div class="accordion-group">
                <div class="accordion-heading">
                  <p>Yes, this is a tutorial, and including code unrelated to the topic may make it more difficult to follow, but this bare spy.jsp is simply not usable. Let's add some CSS/javascript magic. No worry, we'll use only healthy stuff<!--, no <a href="http://en.wikipedia.org/wiki/Genetically_modified_organism" style="text-decoration: line-through;">GMO</a> -->: <a href="http://twitter.github.com/bootstrap/">Bootstrap</a>, <a href="http://jquery.com/">JQuery</a> and <a href="http://datatables.net/">Datatables</a>, all fetched via <a href="http://en.wikipedia.org/wiki/Content_delivery_network">CDN</a>.<!-- And yes, in a tutorial, acronyms should be forbidden by law.--></p> 
                  <p>Copy &amp; replace all the <code>spy.jsp</code> code with <a href="https://github.com/cthiebaud/abendrot/blob/328dc9fca7adb409df563bf5a4addf101b92b1fb/src/main/webapp/spy.jsp">this new version from github</a>. Diff:
                  <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-look-in-the-motor" href="#collapse-look-in-the-motor-2"><i class="icon-chevron-right"></i></a>
                  </p>
                </div>
                <div id="collapse-look-in-the-motor-2" class="accordion-body collapse out">
                  <div class="accordion-inner">
<!-- quickdiff.com -->
<p>
<style scoped>
  @import url('./assets/css/quickdiff.com.styles.css');
  @import url('./assets/css/quickdiff.com.styles2.css');
</style>
<div><i>HTML diff generated @ <a href="quickdiff.com">quickdiff.com</a></i></div>
<!--link scoped rel="stylesheet" type="text/css" href="./assets/css/quickdiff.com.styles.css" -->
<!--link scoped rel="stylesheet" type="text/css" href="./assets/css/quickdiff.com.styles2.css" -->

<table>
  <tbody id="res"><tr><td class="codekolom">1</td><td class="codekolom">1</td><td class="bredecode">  &lt;%@  page language="java"</td></tr><tr><td class="codekolom">2</td><td class="codekolom">2</td><td class="bredecode">  %&gt;&lt;%@page import="java.util.Map"</td></tr><tr><td class="codekolom">3</td><td class="codekolom">3</td><td class="bredecode">  %&gt;&lt;%@page import="java.util.Properties"</td></tr><tr><td class="codekolom">4</td><td class="codekolom">4</td><td class="bredecode">  %&gt;&lt;%@page import="java.util.TreeSet"</td></tr><tr><td class="codekolom">5</td><td class="codekolom">5</td><td class="bredecode">  %&gt;&lt;!DOCTYPE html&gt;</td></tr><tr><td class="codekolom">6</td><td class="codekolom">6</td><td class="bredecode">  &lt;html&gt;</td></tr><tr><td class="codekolom">7</td><td class="codekolom">7</td><td class="bredecode">    &lt;head&gt;</td></tr><tr><td class="codekolom">8</td><td class="codekolom">8</td><td class="bredecode">      &lt;title&gt;abendrot | spy&lt;/title&gt;</td></tr><tr><td class="codekolom">9</td><td class="codekolom">9</td><td class="bredecode">      &lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">10</td><td class="bredecode">+     </td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">11</td><td class="bredecode">+     &lt;!-- Bootstrap CSS --&gt;</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">12</td><td class="bredecode"><!-- +     &lt;link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"&gt;--></td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">13</td><td class="bredecode">+     &lt;!-- DataTables CSS --&gt;</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">14</td><td class="bredecode">+     &lt;link rel="stylesheet" type="text/css" href="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/css/jquery.dataTables.css"&gt;</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">15</td><td class="bredecode">+   </td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">16</td><td class="bredecode">+     &lt;style type="text/css"&gt;</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">17</td><td class="bredecode">+     body {</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">18</td><td class="bredecode">+       padding : 40px;</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">19</td><td class="bredecode">+     }</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">20</td><td class="bredecode">+     &lt;/style&gt;</td></tr><tr><td class="codekolom">10</td><td class="codekolom">21</td><td class="bredecode">    &lt;/head&gt;</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">22</td><td class="bredecode">+   </td></tr><tr><td class="codekolom">11</td><td class="codekolom">23</td><td class="bredecode">    &lt;body&gt;</td></tr><tr class="del"><td class="codekolom">12</td><td class="codekolom"></td><td class="bredecode">-     &lt;table id="properties"&gt;</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">24</td><td class="bredecode">+     &lt;table id="properties" class="table table-striped table-bordered"&gt;</td></tr><tr><td class="codekolom">13</td><td class="codekolom">25</td><td class="bredecode">        &lt;caption&gt;java system properties&lt;/caption&gt;</td></tr><tr><td class="codekolom">14</td><td class="codekolom">26</td><td class="bredecode">        &lt;thead&gt;</td></tr><tr><td class="codekolom">15</td><td class="codekolom">27</td><td class="bredecode">          &lt;tr&gt;</td></tr><tr><td class="codekolom">16</td><td class="codekolom">28</td><td class="bredecode">            &lt;th&gt;key&lt;/th&gt;</td></tr><tr><td class="codekolom">17</td><td class="codekolom">29</td><td class="bredecode">            &lt;th&gt;value&lt;/th&gt;</td></tr><tr><td class="codekolom">18</td><td class="codekolom">30</td><td class="bredecode">          &lt;/tr&gt;</td></tr><tr><td class="codekolom">19</td><td class="codekolom">31</td><td class="bredecode">        &lt;/thead&gt;</td></tr><tr><td class="codekolom">20</td><td class="codekolom">32</td><td class="bredecode">        &lt;tbody&gt;</td></tr><tr><td class="codekolom">21</td><td class="codekolom">33</td><td class="bredecode">  &lt;% Properties properties = System.getProperties();</td></tr><tr><td class="codekolom">22</td><td class="codekolom">34</td><td class="bredecode">  for (String key : new TreeSet&lt;String&gt;(properties.stringPropertyNames())) { %&gt;</td></tr><tr><td class="codekolom">23</td><td class="codekolom">35</td><td class="bredecode">          &lt;tr&gt;</td></tr><tr><td class="codekolom">24</td><td class="codekolom">36</td><td class="bredecode">            &lt;td&gt;&lt;%=key                          %&gt;&lt;/td&gt;</td></tr><tr><td class="codekolom">25</td><td class="codekolom">37</td><td class="bredecode">            &lt;td&gt;&lt;%=properties.getProperty(key) %&gt;&lt;/td&gt;</td></tr><tr><td class="codekolom">26</td><td class="codekolom">38</td><td class="bredecode">          &lt;/tr&gt;</td></tr><tr><td class="codekolom">27</td><td class="codekolom">39</td><td class="bredecode">  &lt;% } %&gt;</td></tr><tr><td class="codekolom">28</td><td class="codekolom">40</td><td class="bredecode">        &lt;/tbody&gt;</td></tr><tr><td class="codekolom">29</td><td class="codekolom">41</td><td class="bredecode">      &lt;/table&gt;</td></tr><tr><td class="codekolom">30</td><td class="codekolom">42</td><td class="bredecode">    &lt;/body&gt;</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">43</td><td class="bredecode">+   </td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">44</td><td class="bredecode">+   &lt;!-- Bootstrap --&gt;</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">45</td><td class="bredecode"><!-- +   &lt;script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"&gt;&lt;/script&gt;--></td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">46</td><td class="bredecode">+   &lt;!-- jQuery --&gt;</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">47</td><td class="bredecode"><!-- +   &lt;script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.9.1.min.js"&gt;&lt;/script&gt;--></td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">48</td><td class="bredecode">+   &lt;!-- DataTables --&gt;</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">49</td><td class="bredecode"><!-- +   &lt;script type="text/javascript" charset="utf8" src="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min.js"&gt;&lt;/script&gt;--></td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">50</td><td class="bredecode">+   </td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">51</td><td class="bredecode">+   &lt;script type="text/javascript"&gt;</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">52</td><td class="bredecode">+   $(document).ready(function(){</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">53</td><td class="bredecode">+     $('#properties').dataTable( {</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">54</td><td class="bredecode">+       "iDisplayLength": -1,</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">55</td><td class="bredecode">+     });</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">56</td><td class="bredecode">+   });</td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">57</td><td class="bredecode"><!-- +   &lt;/script&gt;--></td></tr><tr class="add"><td class="codekolom"></td><td class="codekolom">58</td><td class="bredecode">+ </td></tr><tr><td class="codekolom">31</td><td class="codekolom">59</td><td class="bredecode">  &lt;/html&gt;</td></tr></tbody>
</table>
</p>
<!-- quickdiff.com -->
                  </div>
                </div>
              </div>
              <div class="accordion-group">
                <div class="accordion-heading">
                  <p>Refresh (no need to stop and restart tomcat), the page should now look like :
                  <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-look-in-the-motor" href="#collapse-look-in-the-motor-3"><i class="icon-chevron-right"></i></a>
                  </p>
                </div>
                <div id="collapse-look-in-the-motor-3" class="accordion-body collapse out">
                  <div class="accordion-inner">
                    <!-- img src="./images/nice_spy_in_local_tomcat.png" alt="" alt=""--><span class="img_later" data-src="./images/nice_spy_in_local_tomcat.png" alt=""></span>
                  </div>
                </div>
              </div>
              <div class="accordion-group">
                <div class="accordion-heading">
                  <p>Deploy spy.jsp in the cloud : 
                    <ul class="breadcrumb">
                      <li>commit to local git<span class="divider"><i class="icon-play"></i></span></li>
                      <li>push to remote git<span class="divider"><i class="icon-play"></i></span></li>
                      <li>mvn clean deploy       <span class="divider"><i class="icon-play"></i></span></li>
                      <li>grab a nice cup of <img src="./images/coffee-trans.jpg" style="height:18px; width:auto;"></li>
                    </ul> 
                  </p>
                  <p>Browse to <a class="your_app" href="#">https://&lt;your app&gt;&lt;your user ID&gt;trial.hanatrial.ondemand.com/&lt;your war name&gt;/spy.jsp</a>:
                  <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-look-in-the-motor" href="#collapse-look-in-the-motor-4"><i class="icon-chevron-right"></i></a>
                  </p>
                </div>
                <div id="collapse-look-in-the-motor-4" class="accordion-body collapse out">
                  <div><i>This is HTML, not a screenshot, try to click Previous / Next, or to search for, e.g. 'java.version')</i></div>
                  <div class="accordion-inner">
                    <iframe src='spy.cloud.html' style="width:100%; height: 460px; border: none;"></iframe>
                  </div>
                </div>
              </div>
              <div class="accordion-group">
                <div class="accordion-heading">
                  <p>Looking at these properties, we learn a few things about this SAP HANA Cloud instance : for example, it runs on Java 7, it runs on OSGi and it uses Tomcat to serve HTTP requests.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Add Security Constraint
        ================================================== -->
        <section id="add-security-constraint">
          <div class="page-header">
            <h1>2. Add Security Constraint</h1>
          </div>
          <div class="row-fluid">
            <ul class="thumbnails">
              <li class="span1">
                <span class="thumbnail">
                    <!-- img src="icons/old-rusty-key.jpg" alt="" alt=""--><span class="img_later" data-src="icons/old-rusty-key.jpg" alt=""></span>
                </a>
              </li>
              <div class="lead">Maybe we do not want everybody to access this spy thingy. Let's implement <strong>standard servlet security</strong>, as defined in <a href="http://jcp.org/en/jsr/detail?id=315">the spec</a>: after that, only registered Sap Community Network members 
              (well, that's <a href="http://en.wikipedia.org/wiki/SAP_AG" title='"The SAP Community Network (SCN) has more than 2 million members"'>a lot</a> ... <img src="./icons/smiley_wink.png">) will be able to access it.</div>
            </ul>              
            <div class="accordion" id="accordion-add-security-constraint">
              <div class="accordion-group">
                <div class="accordion-heading">
                  <p>Create a new <code>web.xml</code> file in the <code>src/main/webapp/WEB-INF</code> directory. Copy &amp; paste the code from <a href="https://github.com/cthiebaud/abendrot/blob/990bcf71f939f14fd25faa28d8cdb83e6a1a565c/src/main/webapp/WEB-INF/web.xml">this version from github</a>. 
                  <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-add-security-constraint" href="#collapse-add-security-constraint-1"><i class="icon-chevron-right"></i></a>
                  </p>
                </div>
                <div id="collapse-add-security-constraint-1" class="accordion-body collapse out">
                  <div class="accordion-inner">
<pre class="prettyprint linenums">
&lt;login-config&gt;
  &lt;auth-method&gt;FORM&lt;/auth-method&gt;
&lt;/login-config&gt;

&lt;security-constraint&gt;
  &lt;web-resource-collection&gt;
    &lt;web-resource-name&gt;Protected Area&lt;/web-resource-name&gt;
    &lt;url-pattern&gt;/spy.jsp&lt;/url-pattern&gt;
  &lt;/web-resource-collection&gt;
  &lt;auth-constraint&gt;
    &lt;role-name&gt;Everyone&lt;/role-name&gt;
  &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;

&lt;security-role&gt;
  &lt;description&gt;All SAP HANA Cloud users&lt;/description&gt;
  &lt;role-name&gt;Everyone&lt;/role-name&gt;
&lt;/security-role&gt;
</pre>                    
                  </div>
                </div>
              </div>
              <div class="accordion-group">
                <div class="accordion-heading">
                  <p>
                    <span>In Eclipse, in the servers view, double click on the Local Test Server for SAP HANA Cloud to open the server configuration page, 
                      select the 'Users' tab, then click New User.</span>
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-add-security-constraint" href="#collapse-add-security-constraint-2"><i class="icon-chevron-right"></i></a>
                  </p>
                </div>
                <div id="collapse-add-security-constraint-2" class="accordion-body collapse out">
                  <div class="accordion-inner">
                    <!-- img src="./images/create_new_user.png" alt="" alt=""--><span class="img_later" data-src="./images/create_new_user.png" alt=""></span>
                  </div>
                </div>
              </div>
              <div class="accordion-group">
                <div class="accordion-heading">
                  <p>
                    <span>You are free to enter whatever content in the following dialog box to create a new user. Do not forget to save your modifications of the server configuration (CTRL-S) after closing the dialog.</span>
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-add-security-constraint" href="#collapse-add-security-constraint-3"><i class="icon-chevron-right"></i></a>
                  </p>
                </div>
                <div id="collapse-add-security-constraint-3" class="accordion-body collapse out">
                  <div class="accordion-inner">
                    <!-- img src="./images/trazom.png" alt="" alt=""--><span class="img_later" data-src="./images/trazom.png" alt=""></span>
                  </div>
                </div>
              </div>
              <div class="accordion-group">
                <div class="accordion-heading">
                  <p>
                    <span>Run <code>spy.jsp</code> in the Local Test Server for SAP HANA Cloud. Bing, an authentication form is displayed. Enter the Credentials for the user you've just created, and you are in.</span>
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-add-security-constraint" href="#collapse-add-security-constraint-4"><i class="icon-chevron-right"></i></a>
                  </p>
                </div>
                <div id="collapse-add-security-constraint-4" class="accordion-body collapse out">
                  <div class="accordion-inner">
                    <!-- img src="./images/login_local.png" alt="" alt=""--><span class="img_later" data-src="./images/login_local.png" alt=""></span>
                  </div>
                </div>
              </div>
              <div class="accordion-group">
                <div class="accordion-heading">
                  <p>This local user management provides a nice de-coupling of the development cycle from 'true' authentication providers, such as LDAP servers, that maybe more complex to configure, and less performant, or even out of reach in certain circumstances, e.g. working off-line. It is nevertheless possible to plugin locally other authentication providers. I leave that as an exercice for the reader.</p>
                  <p>Let's see what happens in the cloud. Deploy this application with the modified (new, actually) web.xml. Again, you should be familar with the process now, but I repeat it - for the last time, promised: 
                  <ul class="breadcrumb">
                    <li>commit to local git<span class="divider"><i class="icon-play"></i></span></li>
                    <li>push to remote git<span class="divider"><i class="icon-play"></i></span></li>
                    <li>mvn clean deploy       <span class="divider"><i class="icon-play"></i></span></li>
                    <li>grab some other cups of 
                        <img src="./images/coffee-trans.jpg" style="height:18px; width:auto;">&nbsp;
                        <img src="./images/coffee-trans.jpg" style="height:18px; width:auto;">&nbsp;
                        <img src="./images/coffee-trans.jpg" style="height:18px; width:auto;">
                    </li>
                  </ul> 
                  </p>
                    <p>Refesh <a class="your_app" href="#">https://&lt;your app&gt;&lt;your user ID&gt;trial.hanatrial.ondemand.com/&lt;your war name&gt;/spy.jsp</a></li>
                    <span>Bing, <strong>another</strong> authentication form is displayed. Enter now <strong>your SAP Community Network credentials</strong>, and you are in.</span>
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-add-security-constraint" href="#collapse-add-security-constraint-5"><i class="icon-chevron-right"></i></a>
                  </p>
                  </p>
                </div>
                <div id="collapse-add-security-constraint-5" class="accordion-body collapse out">
                  <div class="accordion-inner">
                    <!-- img src="./images/login_cloud.png" alt="" alt=""--><span class="img_later" data-src="./images/login_cloud.png" alt=""></span>
                  </div>
                </div>
                <div>
                  <p>
                  Authentication on the cloud involves the <a href="http://en.wikipedia.org/wiki/SAML_2.0">Security Assertion Markup Language 2.0 (SAML 2.0)</a> protocol. 
                  </p>
                  <p>
                  Your application subcontracts authentication to the SAP Community Network (cf. the URL in the screen shot above : https://<strong>accounts.sap.com</strong>/...). 
                  </p>
                  <p>
                  For this, a bi-directionnal trust relationship must exist between your app and SAP Community Network: your app trusts that the authentication token provided by SAP Community Network truly identifies <strong>you</strong>, 
                  but before, SAP Community Network has trusted your app to be entitled to query - and make good usage - of authentication tokens. Fortunately, SAP Community Network and SAP HANA Cloud are managed by the same guy (SAP), which helps fostering a strong trust relationship.
                  </p>
                  <p>
                  For SAP HANA Cloud customers that have their own authentication provider. e.g. corporate LDAP, it is possible to setup the same trust relationship and communication process, cf. <a href="https://help.hana.ondemand.com/default.htm?using_identity_provider.html#concept_0B49F10346C94249845EC16364FFF66D_100">Using a Custom Identity Provider</a>.
                  <!-- It is as well possible for the authentication provider of customer to pass extended attributes to the application, such as group information (e.g. admins, super-users, users, guests), upon which the application can react accordingly. -->
                  </p>
                  <p>
                    However, to my knowledge, there is currently no way to subcontract the authentication to 3rd party identity providers, such as Facebook, Twitter, etc. There is little doubt that this feature will be heavily requested.
                  </p>
                <div>
              </div>
            </div>
          </div>
        </section>

        <!-- Coming soon
        ================================================== -->
        <section id="get-back-tomcat-in-the-game">
          <div class="page-header">
            <h1>3. Get Back Tomcat in the Game</h1>
          </div>
          <div class="row-fluid">
            <ul class="thumbnails">
              <li class="span1">
                <span class="thumbnail">
                    <img src="icons/apache-tomcat-150x150.png" alt="">
                </a>
              </li>
              <div class="lead">Our local test Tomcat standalone server needs a little uplift to be able to handle authentication.</div>
            </ul>
            <div class="alert alert-block media unstyled">
              <img src="./icons/smiley_frown.png" class="pull-left">
              <div class="media-body">
                 This work-around applies only to Windows. Sob.
              </div>
            </div>
            <div class="accordion" id="accordion-get-back-tomcat-in-the-game">
              <div class="accordion-group">
                <div class="accordion-heading">
                  <p>You may have noticed that in the previous section, I did not explain how to run your application in your local standalone Tomcat server, now that servlet security is enabled.</p>
                  <p>Unfortunately, with this instruction in the web.xml ...
<pre class="prettyprint linenums">
&lt;login-config&gt;
  &lt;auth-method&gt;FORM&lt;/auth-method&gt;
&lt;/login-config&gt;
</pre>              
                    ... every servlet container expects a HTML form to be implemented somewhere to handle the authentication. SAP HANA Cloud (local as well as remote on he cloud) provides default HTML forms (we've seen both).
                    However, Tomcat has no default. Trying to run <code>spy.jsp</code> on Tomcat leads to a miserable "No login page was defined for FORM authentication" error:
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-get-back-tomcat-in-the-game" href="#collapse-get-back-tomcat-in-the-game-1"><i class="icon-chevron-right"></i></a>
                  </p>
                </div>
                <div id="collapse-get-back-tomcat-in-the-game-1" class="accordion-body collapse out">
                  <div class="accordion-inner">
                    <!-- img src="./images/login_tomcat_error.png" alt="" alt=""--><span class="img_later" data-src="./images/login_tomcat_error.png" alt=""></span>
                  </div>
                </div>
              </div>
              <div class="accordion-group">
                <div class="accordion-heading">
                  <p>At least the error message is clear. We are left with these options:</p>
                  <ol>
                    <li>Implement such a FORM in your application. Not trivial. More important, the application code will diverge between Tomcat and SAP HANA Cloud. We do not want that, do we?</li>
                    <li>Comment and un-comment the security section in web.xml at each switch from testing with Tomcat to testing with SAP HANA Cloud. I even did that for some time. No comment.</li>
                    <li>Implement some kind of scripting, or some <a href="http://maven.apache.org/plugins/maven-resources-plugin/examples/filter.html">maven resources filtering</a> or even write a maven plugin to rewrite the web.xml file at build time based on some profile or parameter. Tecnically feasable, but a pain in the neck.</li>
                    <li>Stop using Tomcat. But we need Tomcat ! First to ensure that our application is not overly coupled with SAP HANA Cloud, second, because hot reloading of jsp is unvaluable to speed up development, and I did not find how to get hot reload with SAP HANA Cloud local test server. If you know that it is possible, please wave your hand.</li>
                  </ol>
                  <p>Enters <a href="http://dblock.github.com/waffle/">WAFFLE</a>, open source <i>Windows &amp; Active Directory Authentication Framework for C# and Java.</i>. Download latest version from  <a href="https://github.com/downloads/dblock/waffle/Waffle.1.5.zip">here</a>, uzip it it somewhere and copy ...
<pre class="prettyprint linenums">
guava-13.0.1.jar
jcl-over-slf4j-1.7.2.jar
jna-3.5.0.jar
platform-3.5.0.jar
slf4j-api-1.7.2.jar
waffle-jna.jar
waffle-tomcat7.jar
</pre>
                    ... from <code>&lt;waffle&gt;/Bin</code>  to <code>&lt;apache-tomcat&gt;/lib</code>. </p>

                    <p>Open <code>context.xml</code> in Package Explorer > Servers > Tomcat v7.0 Server:
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-add-security-constraint" href="#collapse-get-back-tomcat-in-the-game-2"><i class="icon-chevron-right"></i></a>

                <div id="collapse-get-back-tomcat-in-the-game-2" class="accordion-body collapse out">
                  <div class="accordion-inner">
                    <!-- img src="./images/tomcat_waffle_config.png" alt="" alt=""--><span class="img_later" data-src="./images/tomcat_waffle_config.png" alt=""></span>
                  </div>
                </div>
                <div class="accordion-heading">
                  <p> Add ...
<pre class="prettyprint linenums">
&lt;!-- https://github.com/dblock/waffle/blob/master/Docs/tomcat/TomcatSingleSignOnValve.md --&gt;
&lt;Valve className="waffle.apache.NegotiateAuthenticator" /&gt;
&lt;Realm className="waffle.apache.WindowsRealm" /&gt;
</pre>
                    <p>... to <code>context.xml</code>; this installs the waffle authentication provider for Windows in Tomcat. Stop and restart tomcat, run spy.jsp, and bingo !

                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-add-security-constraint" href="#collapse-get-back-tomcat-in-the-game-3"><i class="icon-chevron-right"></i></a>
                  </p>
                </div>
                <div id="collapse-get-back-tomcat-in-the-game-3" class="accordion-body collapse out">
                  <div class="accordion-inner">
                    <!-- img src="./images/login_tomcat_ok.png" alt="" alt=""--><span class="img_later" data-src="./images/login_tomcat_ok.png" alt=""></span>
                  </div>
                </div>
              </div>
              <p>No more form request. Waffle forwards to Tomcat your current Windows identity. Isn't that magic? See <a href="https://github.com/dblock/waffle/tree/master/Docs/tomcat">here</a> for more options to configure Tomcat with waffle.</p>
              <p><img src="./icons/smiley_frown.png"> Alas, this is a Windows only work-around, and Linux or Mac developers will have to opt for one of the options 1. to 4. above, option 3. being probably the less bad. 
                If you have a better solution, please contribute to this tutorial, it's on Github.</p>
            </div>
          </div>
        </section>

        <!-- Who am I
        ================================================== -->
        <section id="who-am-i">
          <div class="page-header">
            <h1>4. Who am I ?</h1>
          </div>
          <div class="row-fluid">
            <ul class="thumbnails">
              <li class="span1">
                <span class="thumbnail">
                    <img src="icons/michael.jpg" alt="">
                </a>
              </li>
              <div class="lead">Basic sample code to query the user identity, and to log out.</div>
            </ul>
            <div class="accordion" id="accordion-who-am-i">
              <div class="accordion-group">
                <div class="accordion-heading">
                  <p>Create a new <code>whoami.jsp</code> file in the <code>src/main/webapp</code> directory. Copy &amp; paste the code from <a href="https://github.com/cthiebaud/abendrot/blob/b9647c7671e7f660449148ba6787ef40faa7dca3/src/main/webapp/whoami.jsp">this version from github</a>. </p>
                  <p>Create a new <code>logout.jsp</code> file in the <code>src/main/webapp</code> directory. Copy &amp; paste the code from <a href="https://github.com/cthiebaud/abendrot/blob/b9647c7671e7f660449148ba6787ef40faa7dca3/src/main/webapp/logout.jsp">this version from github</a>. </p>
                  <p>Play with <code>index.jsp</code> (no authentication required), <code>spy.jsp</code> (authentication required), <code>whoami.jsp</code> (authentication revealed) and <code>logout.jsp</code> (authentication dismissed), in whatever order. Interesting results.
                  <p>NB. <code>logout.jsp</code> uses java reflection to access <code>com.sap.security.auth</code> SAP APIs, otherwise that execution on Tomcat local server would throw a <code>ClassNotFoundException</code>.
                    If you are not concerned with that, it is of course much better <strong>not</strong> to use reflection.
                  </p>
                    <!-- a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion-who-am-i" href="#collapse-who-am-i-1"><i class="icon-chevron-right"></i></a -->
                  </p>
                  <p>NB2. logout does not work with Tomcat (waffle cannot log you out of Windows)</p>
                </div>
                <!--div id="collapse-who-am-i-1" class="accordion-body collapse out">
                  <div class="accordion-inner">
                    <p></p>
                  </div>
                </div-->
              </div>
            </div>
          </div>
        </section>
        <!--
        ================================================== -->

        <!-- Conclusion
        ================================================== -->
        <section id="conclusion">
          <div class="page-header">
            <h1>Conclusion</h1>
          </div>
          <div class="row-fluid">
            <ul class="thumbnails">
              <li class="span2">
                <span class="thumbnail">
                    <img src="icons/old-woman-looking-bored-at-her-laptop.jpg" alt="">
                </a>
              </li>
              <div class="lead">Still with me ? Play with the topics covered in this page here:<div>
              <ul style="display: inline-block">
                <li><a href="http://hana.abendrot.org/index.jsp">http://hana.abendrot.org/index.jsp</a></li>
                <li><a href="http://hana.abendrot.org/spy.jsp">http://hana.abendrot.org/spy.jsp</a></li>
                <li><a href="http://hana.abendrot.org/whoami.jsp">http://hana.abendrot.org/whoami.jsp</a></li>
                <li><a href="http://hana.abendrot.org/logout.jsp">http://hana.abendrot.org/logout.jsp</a></li>
              </ul>
              <p>You must be registered as a <a href="http://scn.sap.com/welcome">SAP Community Network</a> member to access <code>spy.jsp</code>. Hey, it's SAP! :)<p> 
            </ul>
            <p><a href="http://en.wikipedia.org/wiki/Ciao">Ciao!</a></p>
            <!--
            <p>
<a href="https://twitter.com/abenrot_chef" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @abenrot_chef</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<strong>abendrot</strong> on Twitter to be notified of the coming chapters (if time permits, no promises).
            </p>
            -->
            <p>
              <img src="images/abendrot-600x400.jpg" class="center">
            </p>
          </div>
        </section>

      </div>
    </div>

  </div>

  <!-- Le javascript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <!--
  <script type="text/javascript" src="./assets/js/widgets.js"></script>
  -->

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>    

  <!-- script src="./assets/js/jquery.js"></script -->
  <script src="./assets/js/prettify.js"></script>
  <script src="./assets/js/bootstrap.min.js"></script>
  <!--
  <script src="./assets/js/bootstrap-transition.js"></script>
  <script src="./assets/js/bootstrap-alert.js"></script>
  <script src="./assets/js/bootstrap-modal.js"></script>
  <script src="./assets/js/bootstrap-dropdown.js"></script>
  <script src="./assets/js/bootstrap-scrollspy.js"></script>
  <script src="./assets/js/bootstrap-tab.js"></script>
  <script src="./assets/js/bootstrap-tooltip.js"></script>
  <script src="./assets/js/bootstrap-popover.js"></script>
  <script src="./assets/js/bootstrap-button.js"></script>
  <script src="./assets/js/bootstrap-collapse.js"></script>
  <script src="./assets/js/bootstrap-carousel.js"></script>
  <script src="./assets/js/bootstrap-typeahead.js"></script>
  <script src="./assets/js/bootstrap-affix.js"></script>
  -->
  <script src="./assets/js/application.js"></script>

  <script src="./script.js"></script>

  <script type="text/javascript">
  $(function() {
    $(".your_app").click(function(event){
      alert("Replace <your app>, <your user ID> and <your war name> with appropriate values");
    });

    $('span.img_later').prepend( function(index) {
      var src = $(this).attr('data-src');
      return '<img alt="" src="' + src + '">';
    });

  });
  </script>

  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-36199265-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>  


</body></html>